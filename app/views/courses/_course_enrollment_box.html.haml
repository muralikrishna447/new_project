- if current_user
  - if current_user.course_ids.include?(@course.id)
    - course_button_message = current_user.viewed_activities_in_course(@course).count > 0 ? 'Continue Course' : 'Start the Course!'
    = link_to course_button_message, [@course, @course.first_published_activity], class: 'btn, btn-primary btn-large'
  - else
    = form_tag enroll_course_path(@course) do
      = submit_tag 'Enroll', class: 'btn btn-primary btn-large'
- else
  .flat-form.section
    %h2 Enroll for free now
    .section.hide#enroll-section
      = link_to 'Enroll', 'javascript:void(0);', class: 'btn btn-primary btn-large btn-block', id: 'enroll-section-btn'
    .section.hide#signup-or-signin-section
      .row-fluid
        .span6
          = link_to 'Create an Account', 'javascript:void(0);', class: 'btn btn-primary btn-large btn-block', id: 'signup-and-enroll-btn'
        .span6
          = link_to 'Sign In', 'javascript:void(0);', class: 'btn btn-primary btn-large btn-block', id: 'signin-and-enroll-btn'
    .section.hide#signup-and-enroll-section
      = form_for @new_user, url: signup_and_enroll_path, method: :post, class: 'form-inline' do |f|
        = hidden_field_tag :course_id, @course.id
        = f.text_field :name, {placeholder: 'name', required: true, class: 'input-block-level'}
        = f.email_field :email, {placeholder: 'email', required: true, class: 'input-block-level'}
        .input-block-level-password
          = f.password_field :password, {placeholder: 'password', required: true, class: 'input-block-level'}
          = link_to 'Show', 'javascript:void(0);', class: 'btn btn-secondary', id: 'user-password-show'
        = f.submit 'Create Account and Enroll', class: 'btn btn-primary btn-large btn-block', id: 'subscribe-email'
    .section.hide#signin-and-enroll-section
      = form_tag signin_and_enroll_path, method: :post do
        = hidden_field_tag :course_id, @course.id
        = text_field_tag :email, nil, placeholder: 'email', class: 'input-block-level', required: true
        = password_field_tag :password, nil, placeholder: 'password', class: 'input-block-level', required: true
        = submit_tag 'Sign In and Enroll', class: 'btn btn-primary btn-large btn-block'