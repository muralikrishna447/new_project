- content_for :title, "Ingredients"
- content_for :description, "Batch edit ingredients"

.ingredient-index-container.container.relative(ng-controller="IngredientsIndexController" infinite-scroll="loadIngredients()" infinite-scroll-distance="3" ng-cloak)

  .navbar.navbar-fixed-top
    .navbar-inner
      .container
        .form-horizontal
          %input.search-query(type="search" placeholder="Ingredient name..." ng-model="searchString")
          .btn-toolbar
            .btn-group
              %button.btn(ng-model="includeRecipes" btn-checkbox type="button")
                %i.icon-th-list(tooltip="Include recipes" )
              %button.btn(ng-click="refreshIngredients()")
                %i.icon-refresh(tooltip="Refresh list (use when you make changes in another window)")
            .btn-group
              %button.btn(ng-disabled="! canMerge()" ng-click="mergeModalOpen = true" )
                .icon-pair(tooltip="Merge selected ingredients (No Undo!)")
                  %i.icon-arrow-right
                  %i.icon-arrow-left
              %button.btn(ng-disabled="! canDelete()" ng-click="deleteSelected()" )
                %i.icon-trash(tooltipe="Delete selected ingredients (No Undo!)")
          %i.loading-spinner.icon-spinner.icon-spin.pull-right(ng-show="dataLoading")


  .row.noprint(ng-cloak ng-show="alerts.length > 0")
    .span8.offset2
      %alert.alert-block(ng-repeat="alert in alerts" type="alert.type || 'error'" close="closeAlert($index)" ng-animate="'custom'")
        {{alert.message}}

  .row.grid
    .ingredient-index.span12(ng-grid="gridOptions")

  -# This modal and the next one would be a good use for ui-router, but I'm annoyed that they don't have a
  -# released build for 0.0.2 yet so I'm doing it the old fashioned way for now.
  %div.uses-modal(close="usesModalOpen = false" modal="usesModalOpen" options="modalOptions")
    .modal-header
      %h2(ng-bind-html-unsafe="usesForModalIngredient.title")
    .modal-body
      %h3 Used In
      %ul
        %li(ng-repeat="activity in usesForModal")
          %a(ng-href="/activities/{{activity.id}}" target="_blank" ng-bind-html-unsafe="activity.title")
    .modal-footer
      %button.btn.btn-warning.cancel(ng-click="usesModalOpen = false") Close

  -# See comment above
  %div.uses-modal(close="mergeModalOpen = false" modal="mergeModalOpen" options="modalOptions")
    .modal-header
      %h2 Merge Ingredients
      .warning
        %i
          Please read and be very careful. There is no undo!
      Click on the ingredient that you want to keep. All uses of the remaining ingredients will be changed
      to use the chosen ingredient, and the other ingredients will be deleted. If the other ingredients included
      a comma-separated phrase, like "Schnozzleberries, whole", the "whole" part will be moved into the notes
      field in any activity that used it.
    .modal-body
      %ul
        %li(ng-repeat="ingredient in gridOptions.selectedItems | orderBy:'useCount':true")
          %a(ng-bind-html-unsafe="ingredient.title" ng-click="mergeSelected(ingredient)")
          %span
            (Uses: {{ingredient.use_count}})
          %span(ng-show="ingredient.product_url")
            ({{urlAsNiceText(ingredient.product_url)}})
    .modal-footer
      %button.btn.btn-warning.cancel(ng-click="mergeModalOpen = false") Close