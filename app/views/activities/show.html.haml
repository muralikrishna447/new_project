.row
  .span6
    %h1
      = @activity.title
    - if @activity.description?
      :markdown
        #{@activity.description}
  .span6
    = render 'layouts/social_buttons'

.row
  .span12
    .row
      .span6.section
        .video-container
          %iframe{src: youtube_url(@activity.youtube_id)}
        - if @activity.ingredients.any?
          .activity-ingredients-list
            = render 'ingredients_list', activity: @activity
        - if @activity.required_equipment.any?
          %h4 Equipment and Materials
          = render 'equipment_list', equipment: @activity.required_equipment
      .span6.section
        .ordered-steps
          - @activity.steps.each_with_index do |step, index|
            .ordered-step-item
              .step-element.step-number
                = index + 1
              .step-element.step-content
                :markdown
                  #{raw step.directions}
                - if step.ingredients.any?
                  .well
                    %table.ingredients
                      %colgroup
                        %col{width: "66%"}
                        %col{width: "120px"}
                        %col{width: "6%"}
                      %thead
                        %tr
                          %th#ingredient= step.subrecipe_title ? step.subrecipe_title : "Ingredient"
                          %th#quantity{colspan: 2}
                            %a.change_units{title: "Click to change units"} Quantity
                            %a.recipetip{href: "#", rel: "infotip", "data-original-title" => "Click on quantity column header to change units, or any value to scale the recipe."}
                              %i.icon-question-sign

                      - step.ingredients.each do |ingredient|
                        %tr
                          - if ingredient.product_url.present?
                            %td
                              = link_to ingredient.title, ingredient.product_url
                              - if ingredient.for_sale
                                %i.icon-shopping-cart
                          - else
                            %td= ingredient.title
                            %td.quantity-group.qtyfade
                              .lbs-qty
                              .lbs-label
                              .main-qty= ingredient.display_quantity
                            %td.unit.qtyfade= ingredient.unit
              / = link_to '?', '#', class: 'btn btn-warning btn-mini pull-right'

.row
  .span12
    %h3 Techniques
    .carousel-small#technique-carousel
      .carousel-small-inner
        - @techniques.each_with_index do |technique,index|
          %div{class: "item #{'active' if index == 0}"}
            = render 'shared/media_centered', media: technique, media_image: technique.step_images.last, main: 'Technique'
    %h3 You might also like
    .carousel-small#related-carousel
      .carousel-small-inner
        - @recipes.each_with_index do |recipe,index|
          %div{class: "item #{'active' if index == 0}"}
            = render 'shared/media_centered', media: recipe, media_image: recipe.step_images.last, main: 'Recipe'

= #TODO Remove old code below

/ - conditional_cache [activity, version], cache_unless: !cache_show do

/   - disqus_id = "activity-#{activity.id}"

/   - content_for :title, activity.title.html_safe
/   / - content_for :description, activity.description != "" ? activity.description.html_safe : activity.title.html_safe
/   - content_for :canonical_link, activity_url
/   - content_for :keywords, activity.tag_list.join(',')
/   - course = Course.find(params[:course_id]) if params[:course_id]

/   -if params[:scaling]
/     :javascript
/       paramScaling = #{params[:scaling]};

/   .recipe_schema{:itemscope => true, :itemtype => (activity.is_recipe? ? "http://schema.org/Recipe" : nil)}

/     = render 'courses/navigation', course: course, activity: activity, disqus_id: disqus_id

/     .noprint.activity-hero
/       .container
/         %h1= activity.title.html_safe
/         - if activity.youtube_id?
/           .video-container{:itemscope => true, :itemprop => "video", :itemtype => "http://schema.org/VideoObject"}
/             %iframe{src: youtube_url(activity.youtube_id), webkitallowfullscreen: true, mozallowfullscreen:true, allowfullscreen: true }
/           - if activity.transcript?
/             .transcript
/               .btn.btn-primary.pull-right{data: {toggle: 'collapse', target:"#transcript-activity-#{activity.id}"}}
/                 %i.icon-pencil
/                   transcript
/               .transcript-content.collapse{id: "transcript-activity-#{activity.id}"}
/                 = activity.transcript
/         - else
/           - if activity.image_id?
/             .activity-image
/               = image_tag s3_image_url(activity.image_id)

/     = render 'overview', activity: activity
/     -if activity.steps.any?
/       #step-by-step
/         = render 'step_by_step', activity: activity
/     = render 'quizzes', activity: activity
/     = render 'cooked_this_button', activity: activity

/   = render 'layouts/disqus_comments', disqus_id: disqus_id, disqus_title: activity.title, disqus_url: activity_url
