= render 'layouts/filepicker'

- content_for :title, @activity.title.html_safe
- content_for :description, @activity.description != "" ? @activity.description.html_safe : @activity.title.html_safe
- content_for :canonical_link, activity_url(@activity)
- content_for :keywords, @activity.tag_list.join(',')
- content_for :facebook_og do
  %meta{property: 'og:url', content: activity_url(@activity)}
  %meta{property: 'og:title', content: @activity.title.html_safe}
  %meta{property: 'og:description', content: @activity.description != "" ? @activity.description.html_safe : @activity.title.html_safe}
  - if @activity.image_id?
    %meta{property: 'og:image', content: filepicker_activity_hero_image(@activity.image_id)}
  - elsif @activity.featured_image_id?
    %meta{property: 'og:image', content: filepicker_activity_hero_image(@activity.featured_image_id)}
- @body_tag_attributes = {:'ng-app' => "ChefStepsApp", :'ng-controller' => "ActivityController", :'ng-click' => "bodyClick()"}


// This is how the crawler knows to request the _escaped_fragment_ page
- content_for :ajax_seo do
  %meta{name: "fragment", content: "!"}

-if params[:scaling]
  :javascript
    paramScaling = #{params[:scaling]};

.container#activity-body.recipe_schema(ng-cloak="" cseditgroup=""){:itemscope => true, :itemtype => (@activity.is_recipe? ? "http://schema.org/Recipe" : nil), data: {:'activity-id' => @activity.id}}

  .row.printable

    .span6.relative
      %csEditPair
        %csEditPairShow
          %h1.activity-title(ng-bind-html-unsafe="activity.title"){itemprop: 'name'}
        %csEditPairEdit
          = text_area_tag :title, "", {class: "nohtml", rows: "2", data: {:'ng-model' => "activity.title"}, autofocus: 'autofocus'}

    .span6.noprint

      - if ! @minimal
        .pull-left.display-inline-fix(ng-hide="editMode")
          - if @course
            .btn-circle{data: {toggle: 'modal', target: '#syllabus-modal'}}
              %i.icon-file-alt
            - prev_activity = @course.prev_published_activity(@activity)
            - next_activity = @course.next_published_activity(@activity)
            - if prev_activity
              = link_to course_activity_path(@course, prev_activity), class: 'btn-circle' do
                %i.icon-chevron-left
            - if next_activity
              = link_to course_activity_path(@course, next_activity), class: 'btn-circle' do
                %i.icon-chevron-right
          .btn-circle#show-all
            %i.icon-resize-full#show-all-icon
          .btn-circle{onclick: 'window.print()'}
            %i.icon-print
        -if admin_user_signed_in?
          .pull-right
            = render :partial => 'edit_toolbar'

        .pull-right.display-inline-fix(ng-hide="editMode")
          = render 'layouts/social_buttons', media_object: @activity

  .row.printable.printable-column
    .span12
      .row#main-content
        = render 'main_activity_content', activity: @activity
        - if ! @minimal
          = render 'community_tab_fake'

- content_for :bottom do
  - if ! @minimal

    .row(ng-hide="editMode")
      .span12
        %h3 Techniques
        #technique-carousel
          = render 'shared/horizontal_scroller', items: @techniques
        %h3 Recipes
        #related-carousel
          = render 'shared/horizontal_scroller', items: @recipes

    .row(ng-hide="editMode")
      .span12
        %h3 Discussion
        .section
          - disqus_id = "activity-#{@activity.id}"
          = render 'layouts/disqus_comments', disqus_id: disqus_id, disqus_title: @activity.title, disqus_url: activity_url(@activity)

- if @course
  .modal.hide.fade#syllabus-modal
    .modal-header
      = button_tag "X", class: 'close', data: {dismiss:'modal'}
      %h3= @course.title
    .modal-body
      = course_syllabus(@course)

- content_for :popup_bottom do
  - if @viewed_activities && @viewed_activities.count > 2 && current_user.nil?
    .container-fluid.popup-bottom(ng-hide="editMode")
      .row-fluid
        .container
          .row
            .span12
              .row
                .span5.offset1
                  %h3= ab_test 'bottom_popup_copy_1', 'Join the Community', 'Cook Better Than You Ever Thought Possible', 'Learn How to Be a Better Cook'
                  = form_tag welcome_url, :method => :get do
                    = email_field_tag 'email', nil, {class: 'input-signup-email', placeholder: 'Enter email', required: true}
                    = hidden_field_tag :signed_up_from, 'bottom_popup_cta'
                    = submit_tag 'Sign Up Now', class: 'btn btn-secondary', id: 'subscribe-email'
                .span6
                  %h3 Benefits Include
                  %ul
                    %li Ask questions of some of the world's best chefs
                    %li Keep up to date with our latest recipes
                .popup-bottom-close
                  %i.icon-remove

