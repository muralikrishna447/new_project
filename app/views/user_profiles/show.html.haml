- content_for :title, "Profile - #{@user.name}"
/ Don't index user profiles - we don't want to leak Google juice from serious content pages onto profiles, and also some users get upset when they see their profile indexed.
- content_for :extra_head_tags, '<META NAME="ROBOTS" CONTENT="NOINDEX">'.html_safe

.hide
  / Automatically logs in user into forum
  %iframe{src:'http://forum.chefsteps.com/entry/jsconnect?client_id=1924714588&Target=%2F'}

.container-fluid.profile-cover{style: "background-image: url('#{s3_image_url(Setting.footer_image)}')"}
  .row-fluid
    .container
      .row
        .span2.profile-image-wrapper
          .profile-image
            = image_tag filepicker_circle_image(@user.profile_image_id), class: 'img-circle'

        .span10
          %h1= @user.name
          -if can? :manage, User
            =link_to @user.email, "mailto:" + @user.email, { target: "_blank", class: "profile-email-addr"}

.container
  .row
    .span2(ng-controller="LoginController")
      .well.profile-badges
        = render "devise/sessions/new_angular"

        - if @user.badges.any?
          %h4 Badges
          - @user.badges.each do |badge|
            - if badge.image
              = link_to badges_path, anchor: "badge-#{badge.id}" do
                = image_tag badge.image
      - if current_user
        - if current_user == @user
          = link_to 'Edit Profile', edit_user_profile_path, class: 'btn btn-secondary btn-block'
          = link_to 'Add Recipe', "/activities/new", class: 'btn btn-secondary btn-block'
          %div(ng-controller='ProfileRecommendationsModalController' ng-init="init('recommended')")
            %btn.btn.btn-secondary.btn-block(ng-click='open()')
              Recipe Recommendations
          -# %div(ng-controller='FtueModalController')
          -#   %btn.btn.btn-secondary.btn-block(ng-click='start()')
          -#     FTUE
          = link_to 'Sign out', sign_out_path, class: 'btn btn-secondary btn-block'
    .span5.nav-tabs-gray
      %h4 Bio

      %p= @user.bio
      %ul.nav.nav-tabs
        %li.active
          = link_to 'Favorites', '#favorites', data: {toggle: 'tab'}
        %li
          = link_to 'Classes', '#courses', data: {toggle: 'tab'}
        %li
          = link_to 'Photos', '#photos', data: {toggle: 'tab'}
        -if @show_recipes_tab
          %li
            = link_to @is_current_user ? 'My Recipes' : @user.name + '\'s Recipes', '#recipes', data: {toggle: 'tab'}
      .tab-content
        .tab-pane.active#favorites
          - if @user.likes.count > 0
            - @user.likes.scoped_by_type('Activity').order('created_at DESC').each do |like|
              - likeable_title = capture do
                = link_to like.likeable.title, like.likeable
              = render 'shared/media_list_item', image: like.likeable.featured_image, title: likeable_title, text: ''
          - else
            .well-clear
              %h4 Looks like you haven't favorited any recipes yet.
              %div(ng-controller='ProfileRecommendationsModalController' ng-init="init('recommended')")
                %btn.btn.btn-primary(ng-click='open()')
                  See Recommendations
        .tab-pane#courses
          - if @user.enrollments.any?
            - @user.enrollments.each do |enrollment|
              - case enrollment.enrollable_type
              - when 'Course'
                - course_title = capture do
                  = link_to enrollment.enrollable.title, enrollment.enrollable
                - course_text = capture do
                  - if current_user == @user
                    %h4
                      Lesson
                      = @user.viewed_activities_in_course(enrollment.enrollable).count
                      of
                      = enrollment.enrollable.viewable_activities.count
                    = where_user_left_off_in_course(enrollment.enrollable, @user, 'btn btn-primary')
              - when 'Assembly'
                - course_title = capture do
                  = link_to enrollment.enrollable.title, enrollment.enrollable
                - course_text = capture do
                  - if current_user == @user
                    - if @user.completed_course?(enrollment.enrollable)
                      = "Complete!"
                    - else
                      = link_to "Continue Class #{content_tag :i, nil, class: 'icon-chevron-right'}".html_safe, class_path(enrollment.enrollable), class: 'btn btn-primary'
              = render 'shared/media_list_item', image: enrollment.enrollable.featured_image, title: course_title, text: course_text
          - else
            .tab-pane-header
              %h4 Enroll into your first Class today!
              = link_to 'Classes', courses_path, class: 'btn btn-primary'
        .tab-pane#photos
          - @user.uploads.each do |upload|
            - upload_title = capture do
              = link_to upload.title, upload_path(upload)
            = render 'shared/media_list_item', image: upload.image_id, title: upload_title, text: upload.notes
        -if @show_recipes_tab
          .tab-pane#recipes
            - @user_pubbed_recipes.each do |activity|
              - activity_title = capture do
                = link_to activity.title, activity_path(activity)
              = render 'shared/media_list_item', image: activity.featured_image, title: activity_title, text: truncate(activity.description, length: 140, separator: ' ')
            -if @user_unpubbed_recipes.count > 0
              - @user_unpubbed_recipes.each do |activity|
                - activity_title = capture do
                  = link_to activity.title, activity_path(activity)
                = render 'shared/media_list_item', image: activity.featured_image, title: activity_title, text: truncate(activity.description, length: 140, separator: ' ') + " [Unpublished]"
            -if @can_add_recipes
              .media-list-item
                = link_to 'Create a new recipe', new_activity_url, class: 'btn btn-primary'

    .span5
      %h4 Timeline
      .timeline
        .text-center
          %h4 Today
        .timeline-media
          .timeline-line
          .timeline-start
          .timeline-end
          .timeline-left
            - @timeline_events.in_groups_of(2).map(&:first).compact.each do |event|
              - if event.trackable_type != 'Course' && event.trackable
                = render "events/#{event.trackable_type.underscore}/#{event.action}", event: event, direction: 'left'
          .timeline-right
            - @timeline_events.in_groups_of(2).map(&:last).compact.each do |event|
              - if event.trackable_type != 'Course' && event.trackable
                = render "events/#{event.trackable_type.underscore}/#{event.action}", event: event, direction: 'right'
        .text-center
          - if current_user == @user
            %h4= "You joined ChefSteps on"
          - else
            %h4= "#{@user.name} joined ChefSteps on"
          %h4= "#{@user.created_at.strftime('%B %-d, %Y')}."

        / - @user.events.timeline.each_with_index do |event, index|
        /   - direction = index.even? ? 'left' : 'right'
        /   = render "events/#{event.trackable_type.underscore}/#{event.action}", event: event, direction: direction

= content_for :footer do
  = render 'layouts/footer'


= render 'shared/social_connect'
