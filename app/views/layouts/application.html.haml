!!! 5
%html.no-js{lang: "en", 'xmlns:fb' => "http://ogp.me/ns/fb#", :class => "#{'fs-course' if @hide_nav} chefsteps-main", :style => "font-size: 62.5% !important;"}
  %head

    -if 0 && @show_app_add
      %meta(name="apple-itunes-app" content="app-id=816731096, affiliate-data=at=10lIEQ&ct=MWSmartBanneriPhone, app-argument=http://nytimes.com?fromSmartAppBanner=1")
      %meta(name="apple-mobile-web-app-title" content="ChefSteps")
    = render 'layouts/cdn_js'
    %style
    / http://stackoverflow.com/questions/3326650/console-is-undefined-error-for-internet-explorer
    %script(type="text/javascript")
      if (!window.console) console = {log: function() {}};
      window.lastPerfTime = new Date();
      window.logPerf = function(where) {d2 = new Date(); console.log(where + ": " + (d2 - window.lastPerfTime)); window.lastPerfTime = d2;};
      logPerf("HEAD");

    -if "#{yield :title}".include? 'ChefSteps'
      %title= "#{yield :title}"
    -else
      %title= "#{yield :title} | ChefSteps"

    = stylesheet_link_tag 'application', media: 'all'
    = stylesheet_link_tag 'print',  media: 'print'
    %meta{charset: 'utf-8'}
    -if yield(:description).present?
      %meta{name: 'description', content: yield(:description)}
    -if yield(:keywords).present?
      %meta{name: 'keywords', content: yield(:keywords)}
    -if yield(:extra_head_tags).present?
      = yield :extra_head_tags
    %meta{name: 'viewport', content: 'width=device-width, initial-scale=1, user-scalable=no, maximum-scale=1'}
    %meta{"http-equiv" => "Content-Language", content: "en"}
    = csrf_meta_tags
    %meta{name: "google-signin-cookiepolicy", content: "single_host_origin"}
    = auto_discovery_link_tag :atom, feed_path
    = auto_discovery_link_tag :rss, feed_path
    %meta{:name => "google-translate-customization", :content => "d64492c5d22d7921-60170f9c9b7267c6-g7179c5f7a7e64573-d"}
    %link{href: 'https://plus.google.com/106370441183974123730?rel=author'}

    -# Favicons
    %link( rel="apple-touch-icon" sizes="57x57" href="https://d92f495ogyf88.cloudfront.net/favicons/apple-touch-icon-57x57.png?v=yyy4wNKzaA")
    %link( rel="apple-touch-icon" sizes="60x60" href="https://d92f495ogyf88.cloudfront.net/favicons/apple-touch-icon-60x60.png?v=yyy4wNKzaA")
    %link( rel="apple-touch-icon" sizes="72x72" href="https://d92f495ogyf88.cloudfront.net/favicons/apple-touch-icon-72x72.png?v=yyy4wNKzaA")
    %link( rel="apple-touch-icon" sizes="76x76" href="https://d92f495ogyf88.cloudfront.net/favicons/apple-touch-icon-76x76.png?v=yyy4wNKzaA")
    %link( rel="apple-touch-icon" sizes="114x114" href="https://d92f495ogyf88.cloudfront.net/favicons/apple-touch-icon-114x114.png?v=yyy4wNKzaA")
    %link( rel="apple-touch-icon" sizes="120x120" href="https://d92f495ogyf88.cloudfront.net/favicons/apple-touch-icon-120x120.png?v=yyy4wNKzaA")
    %link( rel="apple-touch-icon" sizes="144x144" href="https://d92f495ogyf88.cloudfront.net/favicons/apple-touch-icon-144x144.png?v=yyy4wNKzaA")
    %link( rel="apple-touch-icon" sizes="152x152" href="https://d92f495ogyf88.cloudfront.net/favicons/apple-touch-icon-152x152.png?v=yyy4wNKzaA")
    %link( rel="apple-touch-icon" sizes="180x180" href="https://d92f495ogyf88.cloudfront.net/favicons/apple-touch-icon-180x180.png?v=yyy4wNKzaA")
    %link( rel="icon" type="image/png" href="https://d92f495ogyf88.cloudfront.net/favicons/favicon-32x32.png?v=yyy4wNKzaA" sizes="32x32")
    %link( rel="icon" type="image/png" href="https://d92f495ogyf88.cloudfront.net/favicons/favicon-194x194.png?v=yyy4wNKzaA" sizes="194x194")
    %link( rel="icon" type="image/png" href="https://d92f495ogyf88.cloudfront.net/favicons/favicon-96x96.png?v=yyy4wNKzaA" sizes="96x96")
    %link( rel="icon" type="image/png" href="https://d92f495ogyf88.cloudfront.net/favicons/android-chrome-192x192.png?v=yyy4wNKzaA" sizes="192x192")
    %link( rel="icon" type="image/png" href="https://d92f495ogyf88.cloudfront.net/favicons/favicon-16x16.png?v=yyy4wNKzaA" size="16x16")
    %link( rel="manifest" href="https://d92f495ogyf88.cloudfront.net/favicons/manifest.json?v=yyy4wNKzaA")
    %link( rel="shortcut icon" href="https://d92f495ogyf88.cloudfront.net/favicons/favicon.ico?v=yyy4wNKzaA")
    %meta( name="msapplication-TileColor" content="#da532c")
    %meta( name="msapplication-TileImage" content="https://d92f495ogyf88.cloudfront.net/favicons/mstile-144x144.png?v=yyy4wNKzaA")
    %meta( name="theme-color" content="#ffffff")

    - unless yield(:canonical_link).blank?
      %link{rel: "canonical", href: yield(:canonical_link) }
    %link{href: "//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css", rel: "stylesheet", type: "text/css"}
    %link{href: "//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css", rel: "stylesheet", type: "text/css"}
    %link(href="/chefsteps-icons.css" rel="stylesheet" type="text/css")

    = render 'layouts/mixpanel'
    = render 'layouts/google_analytics'
    = render 'layouts/filepicker'
    = render 'layouts/twitter'
    - if yield(:facebook_og).blank?
      = render 'layouts/facebook_og_default'
    - else
      = yield :facebook_og
    = yield :twitter_cards
    - unless yield(:ajax_seo).blank?
      = yield :ajax_seo
    :javascript
      window.youtubeAPIReady = false;
      window.onYouTubeIframeAPIReady = function() {
        console.log('YT API ready')
        window.youtubeAPIReady = true;
      }

    %script(src='//www.youtube.com/iframe_api' async='true')

    -# Not async on purpose, csembedvimeo assumes loaded
    %script(src='//f.vimeocdn.com/js/froogaloop2.min.js')

    // Send Bloom Encrypted User data
    - if current_user
      :javascript
        window.encryptedUser = "#{escape_javascript(current_user.encrypted_bloom_info)}";
        window.chefstepsUserId = "#{current_user.id}"
    - else
      :javascript
        window.chefstepsUserId = null
    :javascript
      angular.module('csConfig', []).constant('csConfig', #{raw Rails.application.config.shared_config.to_json});

  %body{@body_tag_attributes || {:'ng-app' => "ChefStepsApp"}, :'ng-click' => "$broadcast('bodyClicked')", :class => "#{Rails.env} #{'fs-course' if @hide_nav} controller-#{controller_name} action-#{action_name}", 'ng-init' =>  "environmentConfiguration.google_app_id = '#{google_app_id}'; environmentConfiguration.environment = '#{Rails.env}'; is_static_render=#{is_static_render};"}

    #rails-flash.hide
      = flash.to_json

    = render 'shared/cookie_consent_banner'
    = render 'layouts/navigation', external: false
    .nav-spacer.noprint

    .container.noprint.cookies-disabled(style="display:none;")
      .row-fluid
        %strong We Need Cookies
        ChefSteps accounts work best with cookies enabled in your browser. These are little text files stored on your computer that tell us to remember stuff. If you just want to look at recipes, go for it! If you want all the benefits of an account, please enable cookies.

    = yield

    / %csglobalmessage

    / modals /
    / %cs-ftue-nav
    / %div(ng-controller='SurveyModalController')
    / %div(ng-controller='ConnectModalController')
    / %div(ng-controller='InviteModalController')
    / %div(ng-controller='WelcomeModalController')
    / %div(ng-controller='RecommendationsModalController')

    .container-fluid.noprint#slider-container.ng-cloak
      .row-fluid
        .container
          = yield :bottom

    = yield :popup_bottom

    = yield :footer

  / = render 'layouts/youtube'
  / = render 'layouts/app_init'

  = render "layouts/login_hack"
  = javascript_include_tag 'application'
  %script(type="text/javascript")
    logPerf("POST APP");


  = render 'layouts/facebook'
  = render 'layouts/google'
  - if Rails.env.production?
    = render 'layouts/adwords_remarketing'
    = render 'layouts/facebook_remarketing'

  = render 'layouts/embedly'
  = yield(:custom_js)

  .cs-icons
    = inline_svg('cs-icons.svg')

-# This load on every page, so a convenient place to make sure mixpanel identity is known
- if !is_consent_needed?
  - if current_user
    :javascript
      mixpanel.identify("#{current_user.id}")
