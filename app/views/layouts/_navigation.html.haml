- if ! @minimal
  - if external
    .cs-nav
      .cs-nav-logo
        = link_to root_url do
          .logo-box
            %img.regular-logo(src="https://s3.amazonaws.com/chefsteps/static/chefsteps-logo-h-tagline.png")
  - else
    .cs-nav(ng-controller="NavbarController")
      .cs-nav-logo
        = link_to root_url do
          %cs-loading
          
      .cs-nav-profile-container(ng-show="!editMode" ng-cloak ng-controller="LoginController" ng-init="registrationSource='nav'; authentication.setCurrentUser(#{current_user.to_json(methods: :authentication_token, include: [:enrollments])});")
        - if current_user
          .cs-nav-profile
            = link_to user_profile_url(current_user) do
              .profile-image
                = image_tag filepicker_arbitrary_image(current_user.profile_image_id, 75)
          .cs-nav-notifs
            %csnotifs
        - else
          %a#nav-sign-in-button(ng-show="(! authentication.currentUser())" ng-click="openModal('login')") Sign In
          = render "devise/sessions/new_angular"
          = link_to 'Profile', user_profile_url('self'), "ng-show" => "(authentication.currentUser())", class: "profile-link"

      .cs-nav-items(ng-show="!editMode")
        .cs-nav-items-toggle(ng-click="toggleMenu()")
          Menu
        %ul.cs-nav-links-container(ng-class="{'cs-nav-menu-open': showMenu}")
          .cs-nav-links(ng-hide="showSearch")
            %li
              %a(href='/gallery')
                Recipes
            %li.cs-nav-dropdown
              %a.csn-nav-resources-toggle(ng-click="showResources = !showResources")
                Resources
                %i.fa.fa-caret-down
              .cs-nav-dropdown-menu(ng-show="showResources" ng-cloak)
                %ul
                  %li
                    %a(href='/ingredients')
                      Ingredients
                  %li
                    %a(href='/courses')
                      Classes
                  %li
                    %a(href='/knife-collection')
                      Knife Collection
                  %li
                    %a(href='/sous-vide-collection')
                      Sous Vide Collection
            %li
              %a(href='http://forum.chefsteps.com/discussions')
                Forum

          .cs-nav-search(ng-class="{'cs-nav-search-open': showSearch}")
            %li
              .cs-nav-search-toggle(ng-click="toggleSearch()")
                %i.fa.fa-search
              .cs-nav-search-input(ng-show="showSearch" ng-cloak)
                %form(ng-submit="getSearchQuery()" method="get" name="search" ng-controller="SearchController")
                  %input(placeholder="search" ng-model="navbarSearchQuery")
              .cs-nav-search-close
                %i.fa.fa-times(ng-click="toggleSearch()")

      %div
        -if @include_edit_toolbar
          #nav-edit-toolbar(collapse="!editMode")
            = render 'activities/edit_toolbar'