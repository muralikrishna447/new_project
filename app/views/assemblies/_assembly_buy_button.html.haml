-# Note! Really important to use class_url, not class_path, so we get off SSL after purchase.
-# This way of using ng_init is ugly, need to come up with a better plan. One way
-# would be to retrieve this info via a resource (which could be pre-rendered like)
-# we do for activity show view.

.buy-buttons(ng-controller="BuyAssemblyStripeController" 
              ng-cloak
              ng-init='assembly=#{assembly.to_json}; discounted_price=#{@discounted_price}; logged_in=#{current_user != nil}; enrolled=#{enrolled ? true : false}; assemblyPath="#{class_url(assembly, protocol: "http")}"; completed="#{completed ? true : false}"; lastViewedActivity="#{current_user ? class_activity_path(assembly, current_user.last_viewed_activity_in_assembly(assembly)) : nil}"; gift_certificate=#{gift_certificate.to_json}' )

  -#
  -# Primary CTA
  -# 

  -# Already enrolled
  %div(ng-show="enrolled")
    .main-cta
      %div(ng-hide='completed')
        %a.btn.btn-primary.btn-large.input-block-level(ng-href="{{lastViewedActivity || assemblyPath}}")
          %span Continue Class

      %div(ng-show='completed')
        %a.btn.btn-primary.btn-large.input-block-level(ng-href="{{assemblyPath}}")
          %span View Class

  -# Not enrolled, paid class, gift certificate available
  %div(ng-show="gift_certificate && (! enrolled) && assembly.price")
    .main-cta
      .btn.btn-primary.btn-large.input-block-level#buy-button(ng-click="redeemGift()")
        Get My Gift

  -# Not enrolled, paid class
  %div(ng-show="(! gift_certificate) && (! enrolled) && assembly.price")
    .main-cta
      .btn.btn-primary.btn-large.input-block-level#buy-button(ng-click="openModal(false)")
        BUY NOW
        = render 'activities/latest/assembly_price'

  -# Not enrolled, free class
  %div(ng-show="(! gift_certificate) && (! enrolled) && (discounted_price == '0')")
    .main-cta
      .btn.btn-primary.btn-large.input-block-level#buy-button(ng-click="enroll()")
        Enroll For Free

  -#
  -# Secondary CTA
  -# 

  -# Sell gift certificate
  %div(ng-show="(! gift_certificate) && (assembly.price > 0)")
    .gift-cta
      .btn.btn-secondary.btn-large.input-block-level#gift-button(ng-click="openModal(true)")
        Send As Gift
        %div.inline(ng-show="enrolled")
          = render 'activities/latest/assembly_price'


  =render 'buy_modal'